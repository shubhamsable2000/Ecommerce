"use strict";var Ie=Object.create;var N=Object.defineProperty;var Oe=Object.getOwnPropertyDescriptor;var Pe=Object.getOwnPropertyNames;var Ue=Object.getPrototypeOf,Ee=Object.prototype.hasOwnProperty;var we=(e,r)=>{for(var i in r)N(e,i,{get:r[i],enumerable:!0})},J=(e,r,i,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let o of Pe(r))!Ee.call(e,o)&&o!==i&&N(e,o,{get:()=>r[o],enumerable:!(n=Oe(r,o))||n.enumerable});return e};var y=(e,r,i)=>(i=e!=null?Ie(Ue(e)):{},J(r||!e||!e.__esModule?N(i,"default",{value:e,enumerable:!0}):i,e)),xe=e=>J(N({},"__esModule",{value:!0}),e);var De={};we(De,{CldImage:()=>$,CldOgImage:()=>X,CldUploadButton:()=>Y,CldUploadWidget:()=>b,CldVideoPlayer:()=>K,cloudinaryLoader:()=>D,getCldImageUrl:()=>O,getCldOgImageUrl:()=>me});module.exports=xe(De);var U=y(require("react")),ie=y(require("next/image")),ne=require("@cloudinary-util/util"),ae=require("@cloudinary-util/url-loader");async function G(e){let{src:r}=e;try{await new Promise((i,n)=>{fetch(r).then(o=>{if(!o.ok){n(o);return}i(o)})})}catch(i){return i.status===423?await G(e):!1}return!0}var re=require("@cloudinary-util/url-loader");var Q=y(require("next/package.json"));var Z={name:"next-cloudinary",version:"4.13.0",main:"./dist/index.js",module:"./dist/index.mjs",types:"./dist/index.d.ts",source:"src/index.ts",scripts:{build:"tsup src/index.ts --dts",dev:"tsup src/index.ts --watch --dts",prepublishOnly:"cp ../README.md . && yarn build",postpublish:"rm ./README.md",test:"jest","test:app":'NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME="test" yarn build && cd tests/nextjs-app && yarn build'},dependencies:{"@cloudinary-util/url-loader":"^3.8.1","@cloudinary-util/util":"^2.0.1","@cloudinary/url-gen":"^1.8.6"},devDependencies:{"@babel/core":"^7.19.6","@babel/preset-env":"^7.19.4","@types/jest":"^29.2.0","@types/react":"^18.0.28","@types/react-dom":"^18.0.11","babel-jest":"^29.2.2",dotenv:"^16.0.3",jest:"^29.2.2","jest-environment-jsdom":"^29.2.2","ts-jest":"^29.0.3",tsup:"^6.6.3",typescript:"^4.9.4"},peerDependencies:{next:"^12 || ^13",react:"^17 || ^18"}};var ee="V",te=Z.version,oe=Q.default.version;function O(e,r,i){return(0,re.constructCloudinaryUrl)({options:e,config:Object.assign({cloud:{cloudName:process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME}},r),analytics:Object.assign({sdkCode:ee,sdkSemver:te,techVersion:oe,feature:""},i)})}function D({loaderOptions:e,imageProps:r,cldOptions:i,cldConfig:n={}}){let o={...r,...i};if(o.width=typeof o.width=="string"?parseInt(o.width):o.width,o.height=typeof o.height=="string"?parseInt(o.height):o.height,typeof(e==null?void 0:e.width)=="number"&&typeof o.width=="number"&&e.width!==o.width){let l=e.width/o.width;o.widthResize=e.width,typeof o.height=="number"&&(o.heightResize=Math.round(o.height*l))}return O(o,n)}var Le=e=>{let r=["deliveryType","preserveTransformations"];ae.transformationPlugins.forEach(({props:t=[]})=>{t.forEach(a=>{if(r.includes(a))throw new Error(`Option ${a} already exists!`);r.push(a)})});let i={alt:e.alt,src:e.src};Object.keys(e).filter(t=>!r.includes(t)).forEach(t=>i[t]=e[t]);let n=Object.keys(i).map(t=>`${t}:${i[t]}`).join(";"),[o,l]=(0,U.useState)(n),d={};if(r.forEach(t=>{e[t]&&(d[t]=e[t]||void 0)}),e.preserveTransformations)try{let t=(0,ne.getTransformations)(e.src).map(a=>a.join(","));d.rawTransformations=[...t.flat(),...e.rawTransformations||[]]}catch(t){console.warn(`Failed to preserve transformations: ${t.message}`)}async function m(t){let a=!0;if(typeof e.onError=="function"){let g=e.onError(t);typeof g=="boolean"&&g===!1&&(a=!1)}else typeof e.onError=="boolean"&&e.onError===!1&&(a=!1);if(a===!1)return;let f=t.target;await G({src:f.src})&&l(`${n};${Date.now()}`)}let p=(0,U.useCallback)(m,[G,n]);return U.default.createElement(ie.default,{key:o,...i,loader:t=>D({loaderOptions:t,imageProps:i,cldOptions:d,cldConfig:e.config}),onError:p})},$=Le;var h=y(require("react")),le=y(require("next/head"));var be="summary_large_image",ve=({excludeTags:e=[],twitterTitle:r,keys:i={},...n})=>{let{alt:o}=n,l={...n,crop:n.crop||"fill",gravity:n.gravity||"center",height:n.height||1254,src:n.src,width:n.width||2400,widthResize:n.width||1200},d=typeof l.width=="string"?parseInt(l.width):l.width,m=typeof l.height=="string"?parseInt(l.height):l.height;typeof m=="number"&&typeof d=="number"&&(m=1200/d*m),d=1200;let p=O({...l,format:n.format||"jpg"}),t=O({...l,format:n.format||"webp"}),a={"og:image":"og-image","og:image:secure_url":"og-image-secureurl","og:image:width":"og-image-width","og:image:height":"og-image-height","og:image:alt":"og-image-alt","twitter:title":"twitter-title","twitter:card":"twitter-card","twitter:image":"twitter-image",...i};return h.default.createElement(le.default,null,h.default.createElement("meta",{key:a["og:image"],property:"og:image",content:p}),h.default.createElement("meta",{key:a["og:image:secure_url"],property:"og:image:secure_url",content:p}),h.default.createElement("meta",{key:a["og:image:width"],property:"og:image:width",content:`${d}`}),h.default.createElement("meta",{key:a["og:image:height"],property:"og:image:height",content:`${m}`}),o&&h.default.createElement("meta",{key:a["og:image:alt"],property:"og:image:alt",content:o}),!e.includes("twitter:title")&&h.default.createElement("meta",{key:a["twitter:title"],property:"twitter:title",content:r||" "}),h.default.createElement("meta",{key:a["twitter:card"],property:"twitter:card",content:be}),h.default.createElement("meta",{key:a["twitter:image"],property:"twitter:image",content:t}))},X=ve;var v=y(require("react"));var s=y(require("react")),se=y(require("next/script"));function de(e){return window&&"requestIdleCallback"in window?requestIdleCallback(e):setTimeout(()=>e(),1)}var Te=["success","display-changed"],Ae=({children:e,onClose:r,onError:i,onOpen:n,onUpload:o,options:l,signatureEndpoint:d,uploadPreset:m})=>{let p=(0,s.useRef)(),t=(0,s.useRef)(),a=!!d,[f,T]=(0,s.useState)(void 0),[g,M]=(0,s.useState)(void 0),[V,W]=(0,s.useState)(!0),E={cloudName:process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME,uploadPreset:m||process.env.NEXT_PUBLIC_CLOUDINARY_UPLOAD_PRESET,apiKey:process.env.NEXT_PUBLIC_CLOUDINARY_API_KEY,...l};a&&(E.uploadSignature=w,E.apiKey||console.warn("Missing dependency: Signed Upload requires an API key")),(0,s.useEffect)(()=>{if(typeof g=="undefined")return;let C=g.event==="success",I=g.event==="display-changed"&&g.info==="hidden";C&&typeof o=="function"&&o(g,t.current),I&&typeof r=="function"&&r(t.current)},[g]),(0,s.useEffect)(()=>{f&&typeof i=="function"&&i(f,t.current)},[f]);function A(){W(!1),p.current||(p.current=window.cloudinary),de(()=>{t.current||(t.current=x())})}function w(C,I){if(typeof d=="undefined")throw Error("Failed to generate signature: signatureEndpoint undefined.");fetch(d,{method:"POST",body:JSON.stringify({paramsToSign:I})}).then(u=>u.json()).then(({signature:u})=>{C(u)})}function x(){var C;return(C=p.current)==null?void 0:C.createUploadWidget(E,(I,u)=>{typeof I!="undefined"&&T(I),Te.includes(u==null?void 0:u.event)&&M(u)})}function j(){t.current||(t.current=x()),t==null||t.current.open(),typeof n=="function"&&n(t.current)}return s.default.createElement(s.default.Fragment,null,typeof e=="function"&&e({cloudinary:p.current,widget:t.current,open:j,results:g,error:f,isLoading:V}),s.default.createElement(se.default,{id:`cloudinary-uploadwidget-${Math.floor(Math.random()*100)}`,src:"https://widget.cloudinary.com/v2.0/global/all.js",onLoad:A,onError:C=>console.error(`Failed to load Cloudinary Upload Widget: ${C.message}`)}))},b=Ae;var Ne=({children:e,onClick:r,onError:i,onUpload:n,options:o,signatureEndpoint:l,uploadPreset:d,...m})=>v.default.createElement(v.default.Fragment,null,v.default.createElement(b,{onError:i,onUpload:n,options:o,signatureEndpoint:l,uploadPreset:d},({open:p,isLoading:t})=>{function a(f){f.preventDefault(),p(),typeof r=="function"&&r(f)}return v.default.createElement("button",{...m,onClick:a,disabled:t},e||"Upload")})),Y=Ne;var c=y(require("react")),pe=y(require("next/script")),ce=y(require("next/head")),Ge=e=>{let r=(0,c.useRef)(Math.ceil(Math.random()*1e5)),{autoPlay:i="never",className:n,colors:o,controls:l=!0,fontFace:d,height:m,id:p,logo:t=!0,loop:a=!1,muted:f=!1,onDataLoad:T,onError:g,onMetadataLoad:M,onPause:V,onPlay:W,onEnded:E,src:A,transformation:w,version:x="1.9.4",quality:j="auto",width:C}=e,I=Array.isArray(w)?w:[w];I.unshift({quality:j});let u=(0,c.useRef)(),ge=(0,c.useRef)(),R=e.videoRef||ge,fe=(0,c.useRef)(),S=e.playerRef||fe,ue=p||`player-${A.replace("/","-")}-${r.current}`,k="cld-video-player cld-fluid";n&&(k=`${k} ${n}`);let H={error:g,loadeddata:T,loadedmetadata:M,pause:V,play:W,ended:E};function ye(P){let _=H[P.type];typeof _=="function"&&_(he())}function Ce(){if("cloudinary"in window){u.current=window.cloudinary;let P={};typeof t=="boolean"?P.showLogo=t:typeof t=="object"&&(P={...P,showLogo:!0,logoImageUrl:t.imageUrl,logoOnclickUrl:t.onClickUrl});let _={autoplayMode:i,cloud_name:process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME,controls:l,fontFace:d||"",loop:a,muted:f,publicId:A,secure:!0,transformation:I,...P};typeof o=="object"&&(_.colors=o),S.current=u.current.videoPlayer(R.current,_),Object.keys(H).forEach(z=>{var q;typeof H[z]=="function"&&((q=S.current)==null||q.on(z,ye))})}}function he(){return{player:S.current,video:R.current}}return c.default.createElement(c.default.Fragment,null,c.default.createElement(ce.default,null,c.default.createElement("link",{href:`https://unpkg.com/cloudinary-video-player@${x}/dist/cld-video-player.min.css`,rel:"stylesheet"})),c.default.createElement("div",{style:{width:"100%",aspectRatio:`${e.width} / ${e.height}`}},c.default.createElement("video",{ref:R,id:ue,className:k,width:C,height:m}),c.default.createElement(pe.default,{id:`cloudinary-videoplayer-${Math.floor(Math.random()*100)}`,src:`https://unpkg.com/cloudinary-video-player@${x}/dist/cld-video-player.min.js`,onLoad:Ce,onError:P=>console.error(`Failed to load Cloudinary Video Player: ${P.message}`)})))},K=Ge;function me(e){return O({...e,crop:e.crop||"fill",format:e.format||"jpg",gravity:e.gravity||"center",height:e.height||1254,width:e.width||2400,widthResize:e.width||1200})}0&&(module.exports={CldImage,CldOgImage,CldUploadButton,CldUploadWidget,CldVideoPlayer,cloudinaryLoader,getCldImageUrl,getCldOgImageUrl});
//# sourceMappingURL=index.js.map