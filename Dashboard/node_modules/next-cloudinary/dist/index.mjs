import me,{useState as ge,useCallback as fe}from"react";import ue from"next/image";import{getTransformations as ye}from"@cloudinary-util/util";import{transformationPlugins as Ce}from"@cloudinary-util/url-loader";async function L(e){let{src:a}=e;try{await new Promise((n,r)=>{fetch(a).then(o=>{if(!o.ok){r(o);return}n(o)})})}catch(n){return n.status===423?await L(e):!1}return!0}import{constructCloudinaryUrl as ce}from"@cloudinary-util/url-loader";import pe from"next/package.json";var X={name:"next-cloudinary",version:"4.13.0",main:"./dist/index.js",module:"./dist/index.mjs",types:"./dist/index.d.ts",source:"src/index.ts",scripts:{build:"tsup src/index.ts --dts",dev:"tsup src/index.ts --watch --dts",prepublishOnly:"cp ../README.md . && yarn build",postpublish:"rm ./README.md",test:"jest","test:app":'NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME="test" yarn build && cd tests/nextjs-app && yarn build'},dependencies:{"@cloudinary-util/url-loader":"^3.8.1","@cloudinary-util/util":"^2.0.1","@cloudinary/url-gen":"^1.8.6"},devDependencies:{"@babel/core":"^7.19.6","@babel/preset-env":"^7.19.4","@types/jest":"^29.2.0","@types/react":"^18.0.28","@types/react-dom":"^18.0.11","babel-jest":"^29.2.2",dotenv:"^16.0.3",jest:"^29.2.2","jest-environment-jsdom":"^29.2.2","ts-jest":"^29.0.3",tsup:"^6.6.3",typescript:"^4.9.4"},peerDependencies:{next:"^12 || ^13",react:"^17 || ^18"}};var Y="V",K=X.version,z=pe.version;function h(e,a,n){return ce({options:e,config:Object.assign({cloud:{cloudName:process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME}},a),analytics:Object.assign({sdkCode:Y,sdkSemver:K,techVersion:z,feature:""},n)})}function R({loaderOptions:e,imageProps:a,cldOptions:n,cldConfig:r={}}){let o={...a,...n};if(o.width=typeof o.width=="string"?parseInt(o.width):o.width,o.height=typeof o.height=="string"?parseInt(o.height):o.height,typeof(e==null?void 0:e.width)=="number"&&typeof o.width=="number"&&e.width!==o.width){let l=e.width/o.width;o.widthResize=e.width,typeof o.height=="number"&&(o.heightResize=Math.round(o.height*l))}return h(o,r)}var he=e=>{let a=["deliveryType","preserveTransformations"];Ce.forEach(({props:t=[]})=>{t.forEach(i=>{if(a.includes(i))throw new Error(`Option ${i} already exists!`);a.push(i)})});let n={alt:e.alt,src:e.src};Object.keys(e).filter(t=>!a.includes(t)).forEach(t=>n[t]=e[t]);let r=Object.keys(n).map(t=>`${t}:${n[t]}`).join(";"),[o,l]=ge(r),d={};if(a.forEach(t=>{e[t]&&(d[t]=e[t]||void 0)}),e.preserveTransformations)try{let t=ye(e.src).map(i=>i.join(","));d.rawTransformations=[...t.flat(),...e.rawTransformations||[]]}catch(t){console.warn(`Failed to preserve transformations: ${t.message}`)}async function p(t){let i=!0;if(typeof e.onError=="function"){let c=e.onError(t);typeof c=="boolean"&&c===!1&&(i=!1)}else typeof e.onError=="boolean"&&e.onError===!1&&(i=!1);if(i===!1)return;let m=t.target;await L({src:m.src})&&l(`${r};${Date.now()}`)}let s=fe(p,[L,r]);return me.createElement(ue,{key:o,...n,loader:t=>R({loaderOptions:t,imageProps:n,cldOptions:d,cldConfig:e.config}),onError:s})},q=he;import y from"react";import Ie from"next/head";var Oe="summary_large_image",Pe=({excludeTags:e=[],twitterTitle:a,keys:n={},...r})=>{let{alt:o}=r,l={...r,crop:r.crop||"fill",gravity:r.gravity||"center",height:r.height||1254,src:r.src,width:r.width||2400,widthResize:r.width||1200},d=typeof l.width=="string"?parseInt(l.width):l.width,p=typeof l.height=="string"?parseInt(l.height):l.height;typeof p=="number"&&typeof d=="number"&&(p=1200/d*p),d=1200;let s=h({...l,format:r.format||"jpg"}),t=h({...l,format:r.format||"webp"}),i={"og:image":"og-image","og:image:secure_url":"og-image-secureurl","og:image:width":"og-image-width","og:image:height":"og-image-height","og:image:alt":"og-image-alt","twitter:title":"twitter-title","twitter:card":"twitter-card","twitter:image":"twitter-image",...n};return y.createElement(Ie,null,y.createElement("meta",{key:i["og:image"],property:"og:image",content:s}),y.createElement("meta",{key:i["og:image:secure_url"],property:"og:image:secure_url",content:s}),y.createElement("meta",{key:i["og:image:width"],property:"og:image:width",content:`${d}`}),y.createElement("meta",{key:i["og:image:height"],property:"og:image:height",content:`${p}`}),o&&y.createElement("meta",{key:i["og:image:alt"],property:"og:image:alt",content:o}),!e.includes("twitter:title")&&y.createElement("meta",{key:i["twitter:title"],property:"twitter:title",content:a||" "}),y.createElement("meta",{key:i["twitter:card"],property:"twitter:card",content:Oe}),y.createElement("meta",{key:i["twitter:image"],property:"twitter:image",content:t}))},J=Pe;import v from"react";import H,{useState as $,useEffect as Q,useRef as ee}from"react";import Ue from"next/script";function Z(e){return window&&"requestIdleCallback"in window?requestIdleCallback(e):setTimeout(()=>e(),1)}var Ee=["success","display-changed"],we=({children:e,onClose:a,onError:n,onOpen:r,onUpload:o,options:l,signatureEndpoint:d,uploadPreset:p})=>{let s=ee(),t=ee(),i=!!d,[m,x]=$(void 0),[c,A]=$(void 0),[N,G]=$(!0),O={cloudName:process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME,uploadPreset:p||process.env.NEXT_PUBLIC_CLOUDINARY_UPLOAD_PRESET,apiKey:process.env.NEXT_PUBLIC_CLOUDINARY_API_KEY,...l};i&&(O.uploadSignature=P,O.apiKey||console.warn("Missing dependency: Signed Upload requires an API key")),Q(()=>{if(typeof c=="undefined")return;let f=c.event==="success",u=c.event==="display-changed"&&c.info==="hidden";f&&typeof o=="function"&&o(c,t.current),u&&typeof a=="function"&&a(t.current)},[c]),Q(()=>{m&&typeof n=="function"&&n(m,t.current)},[m]);function _(){G(!1),s.current||(s.current=window.cloudinary),Z(()=>{t.current||(t.current=U())})}function P(f,u){if(typeof d=="undefined")throw Error("Failed to generate signature: signatureEndpoint undefined.");fetch(d,{method:"POST",body:JSON.stringify({paramsToSign:u})}).then(g=>g.json()).then(({signature:g})=>{f(g)})}function U(){var f;return(f=s.current)==null?void 0:f.createUploadWidget(O,(u,g)=>{typeof u!="undefined"&&x(u),Ee.includes(g==null?void 0:g.event)&&A(g)})}function D(){t.current||(t.current=U()),t==null||t.current.open(),typeof r=="function"&&r(t.current)}return H.createElement(H.Fragment,null,typeof e=="function"&&e({cloudinary:s.current,widget:t.current,open:D,results:c,error:m,isLoading:N}),H.createElement(Ue,{id:`cloudinary-uploadwidget-${Math.floor(Math.random()*100)}`,src:"https://widget.cloudinary.com/v2.0/global/all.js",onLoad:_,onError:f=>console.error(`Failed to load Cloudinary Upload Widget: ${f.message}`)}))},b=we;var xe=({children:e,onClick:a,onError:n,onUpload:r,options:o,signatureEndpoint:l,uploadPreset:d,...p})=>v.createElement(v.Fragment,null,v.createElement(b,{onError:n,onUpload:r,options:o,signatureEndpoint:l,uploadPreset:d},({open:s,isLoading:t})=>{function i(m){m.preventDefault(),s(),typeof a=="function"&&a(m)}return v.createElement("button",{...p,onClick:i,disabled:t},e||"Upload")})),te=xe;import I,{useRef as T}from"react";import _e from"next/script";import Le from"next/head";var be=e=>{let a=T(Math.ceil(Math.random()*1e5)),{autoPlay:n="never",className:r,colors:o,controls:l=!0,fontFace:d,height:p,id:s,logo:t=!0,loop:i=!1,muted:m=!1,onDataLoad:x,onError:c,onMetadataLoad:A,onPause:N,onPlay:G,onEnded:O,src:_,transformation:P,version:U="1.9.4",quality:D="auto",width:f}=e,u=Array.isArray(P)?P:[P];u.unshift({quality:D});let g=T(),re=T(),M=e.videoRef||re,ie=T(),V=e.playerRef||ie,ne=s||`player-${_.replace("/","-")}-${a.current}`,W="cld-video-player cld-fluid";r&&(W=`${W} ${r}`);let j={error:c,loadeddata:x,loadedmetadata:A,pause:N,play:G,ended:O};function ae(C){let E=j[C.type];typeof E=="function"&&E(de())}function le(){if("cloudinary"in window){g.current=window.cloudinary;let C={};typeof t=="boolean"?C.showLogo=t:typeof t=="object"&&(C={...C,showLogo:!0,logoImageUrl:t.imageUrl,logoOnclickUrl:t.onClickUrl});let E={autoplayMode:n,cloud_name:process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME,controls:l,fontFace:d||"",loop:i,muted:m,publicId:_,secure:!0,transformation:u,...C};typeof o=="object"&&(E.colors=o),V.current=g.current.videoPlayer(M.current,E),Object.keys(j).forEach(B=>{var F;typeof j[B]=="function"&&((F=V.current)==null||F.on(B,ae))})}}function de(){return{player:V.current,video:M.current}}return I.createElement(I.Fragment,null,I.createElement(Le,null,I.createElement("link",{href:`https://unpkg.com/cloudinary-video-player@${U}/dist/cld-video-player.min.css`,rel:"stylesheet"})),I.createElement("div",{style:{width:"100%",aspectRatio:`${e.width} / ${e.height}`}},I.createElement("video",{ref:M,id:ne,className:W,width:f,height:p}),I.createElement(_e,{id:`cloudinary-videoplayer-${Math.floor(Math.random()*100)}`,src:`https://unpkg.com/cloudinary-video-player@${U}/dist/cld-video-player.min.js`,onLoad:le,onError:C=>console.error(`Failed to load Cloudinary Video Player: ${C.message}`)})))},oe=be;function ve(e){return h({...e,crop:e.crop||"fill",format:e.format||"jpg",gravity:e.gravity||"center",height:e.height||1254,width:e.width||2400,widthResize:e.width||1200})}export{q as CldImage,J as CldOgImage,te as CldUploadButton,b as CldUploadWidget,oe as CldVideoPlayer,R as cloudinaryLoader,h as getCldImageUrl,ve as getCldOgImageUrl};
//# sourceMappingURL=index.mjs.map